<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rekap Peserta | BPR/BPRS</title>
<style>
:root{
  --bg:#0d1117;
  --card:#161b22;
  --accent:#58a6ff;
  --success:#238636;
  --warning:#d29922;
  --text:#c9d1d9;
  --muted:#8b949e;
  --border:#30363d;
  --radius:6px;
  --fs-xs:10px;
  --fs-sm:11px;
  --fs-md:12px;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  font-size:var(--fs-sm);
  line-height:1.3;
  height:100vh;
  width:100vw;
  overflow-x:hidden;
  display:flex;
  flex-direction:column;
}

/* Header Compact - Semua di 1 baris */
header{
  background:var(--card);
  border-bottom:1px solid var(--border);
  padding:8px 12px;
  display:flex;
  flex-wrap:nowrap;
  gap:12px;
  align-items:center;
  position:sticky;
  top:0;
  z-index:100;
  width:100%;
  min-width:0;
}
.brand{
  display:flex;
  align-items:center;
  gap:8px;
  flex-shrink:0;
}
.brand-icon{
  width:28px;
  height:28px;
  background:linear-gradient(135deg,var(--accent),#0969da);
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
}
h1{font-size:var(--fs-md);font-weight:600;white-space:nowrap}
.subtitle{font-size:var(--fs-xs);color:var(--muted);display:none}

/* Stats compact di header */
.stats{
  display:flex;
  gap:8px;
  font-size:var(--fs-xs);
  flex-shrink:0;
}
.stat-item{
  text-align:center;
  padding:2px 6px;
  background:var(--bg);
  border-radius:4px;
  border:1px solid var(--border);
}
.stat-value{
  font-size:var(--fs-md);
  font-weight:700;
  color:var(--accent);
  display:block;
  line-height:1.2;
}
.stat-label{
  color:var(--muted);
  text-transform:uppercase;
  font-size:8px;
  letter-spacing:0.3px;
}

/* Upload Button - Style baru */
.upload-btn{
  display:flex;
  align-items:center;
  gap:4px;
  padding:6px 12px;
  background:var(--success);
  color:#fff;
  text-decoration:none;
  border-radius:var(--radius);
  font-size:var(--fs-xs);
  font-weight:600;
  border:1px solid rgba(35,134,54,0.3);
  transition:all 0.2s;
  flex-shrink:0;
  white-space:nowrap;
  cursor:pointer;
}
.upload-btn:hover{
  background:#2ea043;
  transform:translateY(-1px);
  box-shadow:0 2px 8px rgba(35,134,54,0.3);
}
.upload-btn::before{
  content:'';
  font-size:12px;
}

/* Filter box di header */
.filter-box{
  position:relative;
  flex:1;
  min-width:100px;
  max-width:200px;
}
.filter-box::before{
  content:'üîç';
  position:absolute;
  left:8px;
  top:50%;
  transform:translateY(-50%);
  font-size:12px;
  opacity:0.6;
}
#filter{
  width:100%;
  padding:6px 8px 6px 28px;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:var(--radius);
  color:var(--text);
  font-size:var(--fs-sm);
  outline:none;
}
#filter:focus{border-color:var(--accent)}
#filter::placeholder{color:var(--muted);font-size:var(--fs-xs)}
.clear-btn{
  position:absolute;
  right:6px;
  top:50%;
  transform:translateY(-50%);
  background:none;
  border:none;
  color:var(--muted);
  cursor:pointer;
  padding:2px 4px;
  font-size:14px;
  opacity:0;
}
.filter-box:focus-within .clear-btn,.filter-box.has-value .clear-btn{opacity:1}
.clear-btn:hover{color:#f85149}

/* Live indicator di header */
.live-pill{
  display:flex;
  align-items:center;
  gap:4px;
  padding:4px 8px;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:12px;
  font-size:var(--fs-xs);
  color:var(--muted);
  flex-shrink:0;
  white-space:nowrap;
}
.dot{
  width:6px;
  height:6px;
  background:var(--success);
  border-radius:50%;
  animation:pulse 2s infinite;
  flex-shrink:0;
}

/* Main - full width tanpa padding horizontal yang menyebabkan scroll */
main{
  flex:1;
  padding:12px 0;
  display:flex;
  flex-direction:column;
  gap:12px;
  width:100%;
  min-width:0;
  overflow-x:hidden;
}

/* Table dengan Wrap - full width */
.table-wrapper{
  flex:1;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  width:100%;
  margin:0 12px;
  max-width:calc(100% - 24px);
}
.table-scroll{
  flex:1;
  overflow:auto;
  min-height:0;
  width:100%;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:var(--fs-xs);
  table-layout:fixed;
}
thead{
  position:sticky;
  top:0;
  z-index:10;
  width:100%;
  display:table;
  table-layout:fixed;
}
/* Background header full width - warna gelap seperti gambar */
th{
  background:#0d1117;
  color:var(--accent);
  padding:10px 8px;
  text-align:left;
  font-weight:600;
  text-transform:uppercase;
  font-size:9px;
  letter-spacing:0.3px;
  border-bottom:2px solid var(--border);
  white-space:normal;
  word-wrap:break-word;
  cursor:pointer;
  user-select:none;
  line-height:1.2;
  overflow:hidden;
  text-overflow:ellipsis;
}
th.sortable::after{
  content:'‚Üï';
  margin-left:4px;
  opacity:0.3;
  font-size:8px;
}
th.sort-asc::after{content:'‚Üë';opacity:1}
th.sort-desc::after{content:'‚Üì';opacity:1}
tbody{
  display:table;
  width:100%;
  table-layout:fixed;
}
td{
  padding:10px 8px;
  border-bottom:1px solid var(--border);
  color:var(--text);
  white-space:normal;
  word-wrap:break-word;
  word-break:break-word;
  vertical-align:top;
  line-height:1.3;
  overflow:hidden;
}
tbody tr:hover{background:rgba(88,166,255,0.05)}
tbody tr:last-child td{border-bottom:none}

/* KOLOM 0: INSTANSI - sisa ruang setelah kolom lain */
th:nth-child(1),td:nth-child(1){
  width:calc(100% - 50px - 40px - 35%);
  min-width:120px;
}

/* KOLOM 1: BATAS - fixed 50px (8 karakter) dengan wrap */
th:nth-child(2),td:nth-child(2){
  width:50px;
  min-width:50px;
  max-width:50px;
  text-align:center;
  padding:6px 2px;
}

/* KOLOM 2: URL - fixed 40px untuk icon */
th:nth-child(3),td:nth-child(3){
  width:40px;
  min-width:40px;
  max-width:40px;
  text-align:center;
  padding:10px 4px;
}

/* KOLOM 3: FORMASI - 35% */
th:nth-child(4),td:nth-child(4){
  width:35%;
  min-width:150px;
}

/* KOLOM 4+: DIHILANGKAN */
th:nth-child(n+5),td:nth-child(n+5){
  display:none !important;
}

.badge{
  display:inline-flex;
  align-items:center;
  padding:2px 6px;
  border-radius:10px;
  font-size:9px;
  font-weight:600;
  text-transform:uppercase;
  white-space:normal;
  word-wrap:break-word;
  line-height:1.2;
}
.badge-active{
  background:rgba(35,134,54,0.15);
  color:#3fb950;
  border:1px solid rgba(35,134,54,0.3);
}
.badge-pending{
  background:rgba(210,153,34,0.15);
  color:var(--warning);
  border:1px solid rgba(210,153,34,0.3);
}

/* Date cell dengan wrap - max 8 karakter */
.date-cell{
  font-family:monospace;
  font-size:9px;
  color:var(--accent);
  line-height:1.2;
  display:block;
  max-width:100%;
  overflow-wrap:break-word;
  word-wrap:break-word;
  word-break:break-all;
  white-space:normal;
}

/* Link Button - Hanya simbol üîó */
.link-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:24px;
  height:24px;
  background:rgba(88,166,255,0.1);
  color:var(--accent);
  text-decoration:none;
  border-radius:4px;
  font-size:8px;
  border:1px solid rgba(88,166,255,0.2);
  transition:all 0.2s;
  flex-shrink:0;
}
.link-btn:hover{
  background:var(--accent);
  color:#fff;
  transform:scale(1.1);
}
.link-btn::before{
  content:'üîó';
}

/* Text wrap untuk kolom lain */
.text-wrap{
  max-width:100%;
  word-wrap:break-word;
  word-break:break-word;
  white-space:normal;
  line-height:1.4;
}

.empty-state{
  text-align:center;
  padding:40px 20px;
  color:var(--muted);
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.empty-state-icon{
  font-size:32px;
  margin-bottom:8px;
  opacity:0.5;
}

/* Loader */
.loader-overlay{
  position:absolute;
  inset:0;
  background:rgba(13,17,23,0.95);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  z-index:50;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.2s;
}
.loader-overlay.active{
  opacity:1;
  pointer-events:all;
}
.spinner{
  width:24px;
  height:24px;
  border:2px solid var(--border);
  border-top-color:var(--accent);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
.loader-text{
  color:var(--muted);
  font-size:var(--fs-xs);
}

/* Pagination */
.pagination{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:6px;
  padding:10px;
  background:var(--card);
  border-top:1px solid var(--border);
  flex-wrap:wrap;
}
.pagi-btn{
  display:flex;
  align-items:center;
  justify-content:center;
  min-width:28px;
  height:28px;
  padding:0 8px;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:4px;
  color:var(--text);
  font-size:var(--fs-xs);
  cursor:pointer;
}
.pagi-btn:hover:not(:disabled){
  border-color:var(--accent);
  color:var(--accent);
}
.pagi-btn:disabled{
  opacity:0.4;
  cursor:not-allowed;
}
.pagi-info{
  padding:0 12px;
  color:var(--muted);
  font-size:var(--fs-xs);
}
.page-numbers{
  display:flex;
  gap:3px;
}
.page-num{
  min-width:28px;
  height:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:4px;
  color:var(--muted);
  font-size:var(--fs-xs);
  cursor:pointer;
}
.page-num:hover{
  border-color:var(--accent);
  color:var(--accent);
}
.page-num.active{
  background:var(--accent);
  border-color:var(--accent);
  color:#fff;
  font-weight:600;
}

/* Toast */
.toast{
  position:fixed;
  bottom:12px;
  right:12px;
  padding:10px 16px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  gap:8px;
  transform:translateY(100px);
  opacity:0;
  transition:all 0.3s;
  z-index:1000;
  font-size:var(--fs-xs);
}
.toast.show{
  transform:translateY(0);
  opacity:1;
}
.toast-success{border-left:2px solid var(--success)}
.toast-error{border-left:2px solid #f85149}

@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* Responsive */
@media(max-width:768px){
  header{
    padding:6px 8px;
    gap:8px;
  }
  .brand-icon{
    width:24px;
    height:24px;
    font-size:12px;
  }
  h1{font-size:var(--fs-sm)}
  .stats{gap:6px}
  .stat-item{padding:2px 4px}
  .stat-value{font-size:var(--fs-sm)}
  .upload-btn{
    padding:5px 8px;
    font-size:9px;
  }
  .upload-btn::before{
    font-size:10px;
  }
  .filter-box{
    min-width:80px;
    max-width:120px;
  }
  #filter{
    padding:5px 6px 5px 24px;
    font-size:var(--fs-xs);
  }
  .filter-box::before{
    left:6px;
    font-size:10px;
  }
  .live-pill{
    padding:3px 6px;
    font-size:9px;
  }
  main{padding:8px 0}
  .table-wrapper{
    margin:0 8px;
    max-width:calc(100% - 16px);
  }
  th,td{padding:8px 6px;font-size:var(--fs-xs)}
  .badge{padding:2px 4px;font-size:8px}
  .link-btn{
    width:20px;
    height:20px;
    font-size:12px;
  }
  /* Mobile: sesuaikan lebar kolom */
  th:nth-child(1),td:nth-child(1){
    width:calc(100% - 45px - 35px - 40%);
    min-width:100px;
  }
  th:nth-child(2),td:nth-child(2){
    width:45px;
    min-width:45px;
    max-width:45px;
    padding:4px 1px;
  }
  th:nth-child(3),td:nth-child(3){
    width:35px;
    min-width:35px;
    max-width:35px;
  }
  th:nth-child(4),td:nth-child(4){
    width:40%;
    min-width:120px;
  }
  .date-cell{font-size:8px;}
}

@media(max-width:480px){
  :root{--fs-xs:9px;--fs-sm:10px;--fs-md:11px}
  header{
    flex-wrap:wrap;
    padding:6px;
  }
  .brand{
    order:1;
  }
  .stats{
    order:2;
  }
  .upload-btn{
    order:3;
    flex-basis:auto;
  }
  .filter-box{
    order:4;
    flex-basis:calc(100% - 80px);
    max-width:none;
    min-width:auto;
  }
  .live-pill{
    order:5;
    flex-shrink:0;
  }
  .page-numbers{display:none}
  /* Mobile kecil: sesuaikan lebar kolom */
  th:nth-child(1),td:nth-child(1){
    width:calc(100% - 40px - 30px - 45%);
    min-width:80px;
  }
  th:nth-child(2),td:nth-child(2){
    width:40px;
    min-width:40px;
    max-width:40px;
    padding:4px 1px;
  }
  th:nth-child(3),td:nth-child(3){
    width:30px;
    min-width:30px;
    max-width:30px;
  }
  th:nth-child(4),td:nth-child(4){
    width:45%;
    min-width:100px;
  }
  th,td{padding:6px 4px}
  .date-cell{font-size:8px;}
}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="brand-icon">üè¶</div>
    <div>
      <h1>PENCARI LOKER</h1>
    </div>
  </div>
  
  <div class="stats">
    <div class="stat-item">
      <span class="stat-value" id="total-count">0</span>
      <span class="stat-label">Total</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" id="filtered-count">0</span>
      <span class="stat-label">Filter</span>
    </div>
  </div>

  <!-- Tombol Upload Loker - Sejajar dengan stats -->
  <a href="https://forms.gle/iBCTmuPqbu8oEfYP9 " target="_blank" class="upload-btn" title="Upload Loker Baru">Upload
  </a>

  <div class="filter-box" id="filter-box">
    <input id="filter" placeholder="Cari..." autocomplete="off"/>
    <button class="clear-btn" onclick="clearFilter()" title="Clear">√ó</button>
  </div>

  <div class="live-pill">
    <span class="dot"></span>
    <span>Live</span>
  </div>
</header>

<main>
  <div class="table-wrapper">
    <div class="loader-overlay" id="loader">
      <div class="spinner"></div>
      <div class="loader-text">Memuat...</div>
    </div>
    <div class="table-scroll">
      <table>
        <thead id="head"></thead>
        <tbody id="body"></tbody>
      </table>
      <div class="empty-state" id="empty-state" style="display:none">
        <div class="empty-state-icon">üîç</div>
        <div>Tidak ada data</div>
      </div>
    </div>
    <div class="pagination" id="pagination"></div>
  </div>
</main>

<div class="toast" id="toast">
  <span id="toast-icon">‚úì</span>
  <span id="toast-msg">Update</span>
</div>

<script>
const SHEET_URL='https://script.google.com/macros/s/AKfycbwVHk4nk5XTmP69xbUrSModHG796447Z0ex2RFtDh-L2zQ1OHoaxoTDyezFYjSGbes3/exec ';
const ROWS_PER_PAGE=5,REFRESH_MS=10000;
let raw=[[]],filtered=[[]],page=1,sortCol=-1,sortAsc=true,lastHash='';

const $=s=>document.querySelector(s);
const head=$('#head'),body=$('#body'),pagination=$('#pagination'),filter=$('#filter'),loader=$('#loader'),emptyState=$('#empty-state'),filterBox=$('#filter-box'),toast=$('#toast');

const hash=d=>JSON.stringify(d).split('').reduce((a,b)=>((a<<5)-a)+b.charCodeAt(0),0);
const showToast=(m,t='success')=>{
  $('#toast-icon').textContent=t==='success'?'‚úì':'‚úï';
  $('#toast-msg').textContent=m;
  toast.className=`toast toast-${t} show`;
  setTimeout(()=>toast.classList.remove('show'),2500);
};

// Format tanggal ke dd/mm/yyyy dengan wrap untuk kolom sempit
const fmtDate=s=>{
  if(!s)return'-';
  
  let day,month,year;
  const str=String(s).trim();
  
  // Format ISO: 2025-12-09T01:43:07.000Z atau 2025/12/09T01:43:07.000Z
  const isoMatch=str.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})[T\s]/);
  if(isoMatch){
    year=isoMatch[1];
    month=isoMatch[2].padStart(2,'0');
    day=isoMatch[3].padStart(2,'0');
    return {day,month,year};
  }
  
  // Format ISO tanpa timestamp: 2025-12-09 atau 2025/12/09
  const dateOnlyMatch=str.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})$/);
  if(dateOnlyMatch){
    year=dateOnlyMatch[1];
    month=dateOnlyMatch[2].padStart(2,'0');
    day=dateOnlyMatch[3].padStart(2,'0');
    return {day,month,year};
  }
  
  // Format Indonesia: dd/mm/yyyy atau dd-mm-yyyy
  if(str.includes('/')||str.includes('-')){
    const parts=str.split(/[\/\-]/);
    if(parts.length>=3){
      day=parts[0].padStart(2,'0');
      month=parts[1].padStart(2,'0');
      year=parts[2].length===2?'20'+parts[2]:parts[2];
      return {day,month,year};
    }
  }
  
  // Coba parse sebagai Date object
  const d=new Date(str);
  if(!isNaN(d.getTime())){
    day=String(d.getDate()).padStart(2,'0');
    month=String(d.getMonth()+1).padStart(2,'0');
    year=d.getFullYear();
    return {day,month,year};
  }
  
  // Jika semua gagal, return as-is tanpa wrap
  return str;
};

async function pull(showLoad=false){
  if(showLoad)loader.classList.add('active');
  try{
    const r=await fetch(SHEET_URL,{cache:'no-store'});
    const j=await r.json();
    const h=hash(j);
    if(h!==lastHash){
      lastHash=h;raw=j;
      if(filtered.length>1)showToast(`Update: ${raw.length-1} baris`);
      applyFilter();
    }
  }catch(e){
    showToast('Gagal load','error');
  }finally{
    if(showLoad)setTimeout(()=>loader.classList.remove('active'),300);
  }
}

function applyFilter(){
  const q=filter.value.trim().toLowerCase();
  filterBox.classList.toggle('has-value',q.length>0);
  filtered=q?[raw[0],...raw.slice(1).filter(r=>r.some(c=>String(c).toLowerCase().includes(q)))]:[...raw];
  if(sortCol>=0)doSort();
  page=1;updateStats();render();
}
const clearFilter=()=>{filter.value='';applyFilter();filter.focus();};

function doSort(){
  const d=filtered.slice(1);
  d.sort((a,b)=>{
    let va=a[sortCol],vb=b[sortCol];
    return!isNaN(va)&&!isNaN(vb)?(sortAsc?va-vb:vb-va):sortAsc?String(va).localeCompare(vb):String(vb).localeCompare(va);
  });
  filtered=[filtered[0],...d];
}

function updateStats(){
  $('#total-count').textContent=Math.max(0,raw.length-1);
  $('#filtered-count').textContent=Math.max(0,filtered.length-1);
}

function render(){
  // Render hanya 4 kolom (0-3), kolom 4+ disembunyikan
  // Index: 0=INSTANSI, 1=BATAS (tanggal), 2=URL, 3=FORMASI
  const maxCols=4;
  const displayHeaders=filtered[0].slice(0,maxCols);
  
  head.innerHTML='<tr>'+displayHeaders.map((v,i)=>`<th class="sortable ${sortCol===i?(sortAsc?'sort-asc':'sort-desc'):''}" onclick="setSort(${i})">${v}</th>`).join('')+'</tr>';
  
  if(filtered.length<=1){body.innerHTML='';emptyState.style.display='flex';pagination.innerHTML='';return;}
  emptyState.style.display='none';
  
  const s=(page-1)*ROWS_PER_PAGE+1,e=Math.min(s+ROWS_PER_PAGE,filtered.length);
  body.innerHTML=filtered.slice(s,e).map((r,i)=>{
    const displayData=r.slice(0,maxCols);
    return`<tr style="animation:fadeIn 0.2s ease ${i*0.03}s both">${displayData.map((c,j)=>`<td>${fmtCell(c,j)}</td>`).join('')}</tr>`;
  }).join('');
  
  renderPagination(Math.ceil((filtered.length-1)/ROWS_PER_PAGE));
  $('.table-scroll').scrollTop=0;
}

function fmtCell(v,i){
  if(!v)return'-';
  const s=String(v);
  
  // KOLOM 1 (index 1): BATAS - Format tanggal dengan wrap (max 8 char)
  if(i===1){
    const dateObj=fmtDate(v);
    if(typeof dateObj==='object'){
      // Tampilkan dengan wrap: dd/mm di atas, yyyy di bawah
      // Total max 8 karakter per baris
      return`<span class="date-cell">${dateObj.day}/${dateObj.month}<br/>${dateObj.year}</span>`;
    }
    return`<span class="date-cell">${dateObj}</span>`;
  }
  
  // KOLOM 2 (index 2): URL - Hanya simbol üîó
  if(i===2){
    if(s.startsWith('http')){
      return`<a href="${v}" target="_blank" class="link-btn" title="Buka link"></a>`;
    }
    return'-';
  }
  
  // KOLOM 3 (index 3): FORMASI - Text wrap untuk teks panjang
  if(i===3 && s.length>50){
    return`<div class="text-wrap" title="${s}">${s}</div>`;
  }
  
  // KOLOM 0 (index 0): INSTANSI - Status badges jika ada
  const map={'aktif':'badge-active','active':'badge-active','pending':'badge-pending','proses':'badge-pending','diterima':'badge-active','ditolak':'badge-pending'};
  if(map[s.toLowerCase()]){
    return`<span class="badge ${map[s.toLowerCase()]}">${v}</span>`;
  }
  
  return s;
}

function renderPagination(t){
  if(t<=1){pagination.innerHTML='';return;}
  let h=`<button class="pagi-btn" onclick="chgPage(${page-1})" ${page===1?'disabled':''}>‚Äπ</button><span class="pagi-info">${page}/${t}</span><button class="pagi-btn" onclick="chgPage(${page+1})" ${page===t?'disabled':''}>‚Ä∫</button>`;
  if(innerWidth>480&&t>3){
    h+=`<div class="page-numbers">`;
    for(let i=1;i<=t;i++)if(i===1||i===t||Math.abs(i-page)<=1)h+=`<button class="page-num ${i===page?'active':''}" onclick="chgPage(${i})">${i}</button>`;
    h+=`</div>`;
  }
  pagination.innerHTML=h;
}

const setSort=c=>{
  if(sortCol===c)sortAsc=!sortAsc;
  else{sortCol=c;sortAsc=true;}
  applyFilter();
};
const chgPage=p=>{page=p;render();$('.table-scroll').scrollTo({top:0,behavior:'smooth'});};

filter.addEventListener('input',((fn,ms)=>{let t;return()=>{clearTimeout(t);t=setTimeout(fn,ms);}})(applyFilter,300));
filter.addEventListener('keydown',e=>e.key==='Escape'&&clearFilter());
document.addEventListener('keydown',e=>{
  if((e.ctrlKey||e.metaKey)&&e.key==='f'){e.preventDefault();filter.focus();}
  if(e.key==='ArrowLeft'&&page>1)chgPage(page-1);
  if(e.key==='ArrowRight'&&page<Math.ceil((filtered.length-1)/ROWS_PER_PAGE))chgPage(page+1);
});

(async()=>{loader.classList.add('active');await pull();loader.classList.remove('active');setInterval(()=>pull(false),REFRESH_MS);})();
</script>
</body>
</html>
